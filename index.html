<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mis Gastos</title>
    
    <!-- ICONO DE LA APP -->
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/2331/2331966.png">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/2331/2331966.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#667eea">
    
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 15px; 
            color: #333;
            padding-bottom: 80px;
        }
        .container { max-width: 450px; margin: 0 auto; }
        .header { text-align: center; color: white; margin-bottom: 20px; }
        .header h1 { font-size: 24px; margin-bottom: 5px; }
        
        /* NAVEGACI√ìN TABS */
        .tabs { display: flex; gap: 8px; margin-bottom: 20px; background: rgba(255,255,255,0.2); padding: 5px; border-radius: 12px; }
        .tab { flex: 1; padding: 12px 8px; border: none; background: transparent; color: white; font-weight: 600; cursor: pointer; border-radius: 8px; font-size: 13px; transition: 0.3s; }
        .tab.active { background: white; color: #667eea; }
        .tab:hover { background: rgba(255,255,255,0.3); }
        .tab.active:hover { background: white; }
        
        /* SECCIONES */
        .section { display: none; animation: fadeIn 0.3s; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .section-title { color: white; margin: 20px 0 10px; font-size: 16px; text-align: center; }
        .progress-circle { background: white; border-radius: 15px; padding: 20px; text-align: center; margin-bottom: 15px; }
        .circle-percent { font-size: 32px; font-weight: bold; color: #667eea; }
        .balance-box { background: linear-gradient(135deg, #11998e, #38ef7d); color: white; padding: 10px; border-radius: 12px; text-align: center; margin-bottom: 15px; }
        .balance-amount { font-size: 24px; font-weight: bold; }
        .income-grid, .daily-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 15px; }
        .income-card { background: linear-gradient(135deg, #ff9500, #ff6b00); color: white; padding: 12px; border-radius: 10px; text-align: center; }
        .income-card.uber { background: linear-gradient(135deg, #1a1a1a, #333); }
        .daily-card { background: #f8f9fa; padding: 12px; border-radius: 10px; text-align: center; }
        .btn { padding: 8px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; width: 100%; margin-bottom: 8px; font-size: 14px; }        .btn-orange { background: linear-gradient(135deg, #ff9500, #ff6b00); color: white; }
        .btn-black { background: linear-gradient(135deg, #1a1a1a, #333); color: white; }
        .btn-red { background: #e74c3c; color: white; }
        .btn-yellow { background: #f39c12; color: white; }
        .btn-purple { background: #9b59b6; color: white; }
        .btn-primary { background: rgba(255,255,255,0.3); color: white; border: 2px dashed white; }
        .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; }
        .modal.active { display: flex; }
        .modal-content { background: white; border-radius: 15px; padding: 20px; width: 90%; max-width: 320px; }
        .modal input { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; margin: 10px 0; }
        .modal-buttons { display: flex; gap: 8px; }
        .modal button { flex: 1; padding: 12px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; }
        .category-card { background: white; border-radius: 10px; padding: 8px; margin-bottom: 10px; }
        .history-item { background: #f8f9fa; padding: 10px; border-radius: 8px; margin-bottom: 6px; display: flex; justify-content: space-between; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üí∞ Mis Gastos</h1>
            <p id="currentMonth"></p>
        </div>
        
        <!-- NAVEGACI√ìN -->
        <div class="tabs">
            <button class="tab active" onclick="showTab('gastos')">üìÖ Gastos</button>
            <button class="tab" onclick="showTab('balance')">üíµ Balance</button>
            <button class="tab" onclick="showTab('diarios')">üì± Diarios</button>
            <button class="tab" onclick="showTab('historial')">üìã Historial</button>
        </div>
        
        <!-- TAB 1: GASTOS MENSUALES -->
        <div id="tab-gastos" class="section active">
            <h2 class="section-title">üìÖ Gastos Mensuales</h2>
            <div class="progress-circle">
                <div class="circle-percent" id="totalPercent">0%</div>
                <div><span id="totalPaid">$0</span> / <span id="totalGoal">$0</span></div>
            </div>
            <button class="btn btn-primary" onclick="openCategoryModal()">+ Agregar Categoria</button>
            <div id="categoriesList"></div>
        </div>
        
        <!-- TAB 2: BALANCE E INGRESOS -->
        <div id="tab-balance" class="section">
            <h2 class="section-title">üí∞ Balance del Mes</h2>
            <div class="balance-box"><div class="balance-amount" id="balanceAmount">$0</div></div>
            
            <h2 class="section-title">üíµ Ingresos</h2>
            <div style="background:white;border-radius:15px;padding:15px;margin-bottom:15px;">
                <div class="income-grid">                    <div class="income-card"><div style="font-size:24px;">üü†</div><div>Didi</div><div style="font-size:22px;font-weight:bold;" id="totalDidi2">$0</div></div>
                    <div class="income-card uber"><div style="font-size:24px;">‚ö´</div><div>Uber</div><div style="font-size:22px;font-weight:bold;" id="totalUber2">$0</div></div>
                </div>
                <button class="btn btn-orange" onclick="openIncomeModal('Didi')">üü† Didi</button>
                <button class="btn btn-black" onclick="openIncomeModal('Uber')">‚ö´ Uber</button>
            </div>
        </div>
        
        <!-- TAB 3: GASTOS DIARIOS -->
        <div id="tab-diarios" class="section">
            <h2 class="section-title">üì± Gastos Diarios <span id="todayLabel" style="font-size:12px;display:block;margin-top:5px;opacity:0.9;"></span></h2>
            <div style="background:white;border-radius:15px;padding:15px;margin-bottom:15px;">
                <div class="daily-grid">
                    <div class="daily-card" style="border-top:3px solid #e74c3c;"><div style="font-size:24px;">‚õΩ</div><div>GNC</div><div style="font-size:22px;font-weight:bold;color:#e74c3c;" id="totalGNC2">$0</div></div>
                    <div class="daily-card" style="border-top:3px solid #f39c12;"><div style="font-size:24px;">üçî</div><div>Comida</div><div style="font-size:22px;font-weight:bold;color:#f39c12;" id="totalFood2">$0</div></div>
                    <div class="daily-card" style="border-top:3px solid #9b59b6;"><div style="font-size:24px;">üì¶</div><div>Varios</div><div style="font-size:22px;font-weight:bold;color:#9b59b6;" id="totalVarios2">$0</div></div>
                </div>
                <button class="btn btn-red" onclick="openDailyModal('GNC')">‚õΩ GNC</button>
                <button class="btn btn-yellow" onclick="openDailyModal('Comida')">üçî Comida</button>
                <button class="btn btn-purple" onclick="openDailyModal('Varios')">üì¶ Varios</button>
            </div>
        </div>
        
        <!-- TAB 4: HISTORIAL -->
        <div id="tab-historial" class="section">
            <h2 class="section-title">üìã Historial del Mes</h2>
            <div style="background:white;border-radius:15px;padding:15px;">
                <div id="historyList"></div>
            </div>
        </div>
    </div>
    
    <div class="modal" id="modal">
        <div class="modal-content">
            <h3 id="modalTitle" style="margin-bottom:15px;text-align:center;"></h3>
            <input type="text" id="modalName" placeholder="Nombre" style="display:none;">
            <input type="number" id="modalAmount" placeholder="Monto (opcional)" inputmode="numeric">
            <input type="date" id="modalDate">
            <div class="modal-buttons">
                <button style="background:#e0e0e0;" onclick="closeModal()">Cancelar</button>
                <button style="background:#667eea;color:white;" onclick="confirmAction()">Guardar</button>
            </div>
        </div>
    </div>

    <script>
        var categories = JSON.parse(localStorage.getItem('categories')) || [{id:1,name:'Colegio',goal:0,current:0},{id:2,name:'Internet',goal:0,current:0},{id:3,name:'Seguro',goal:0,current:0}];
        var expenses = JSON.parse(localStorage.getItem('expenses')) || [];
        var incomes = JSON.parse(localStorage.getItem('incomes')) || [];
        var currentType = '';        var currentId = null;
        
        document.getElementById('currentMonth').textContent = new Date().toLocaleDateString('es-AR',{month:'long',year:'numeric'});
        document.getElementById('modalDate').value = new Date().toISOString().split('T')[0];
        
        // Mostrar fecha actual en la secci√≥n Diarios
        var today = new Date();
        var todayStr = today.toLocaleDateString('es-AR',{weekday:'long',day:'2-digit',month:'2-digit'});
        document.getElementById('todayLabel').textContent = todayStr.charAt(0).toUpperCase() + todayStr.slice(1);
        
        function init() {
            renderCategories();
            updateTotals();
            renderHistory();
        }
        
        // NAVEGACI√ìN TABS
        function showTab(tabName) {
            // Ocultar todas las secciones
            document.querySelectorAll('.section').forEach(function(s) { s.classList.remove('active'); });
            document.querySelectorAll('.tab').forEach(function(t) { t.classList.remove('active'); });
            
            // Mostrar secci√≥n seleccionada
            document.getElementById('tab-' + tabName).classList.add('active');
            event.target.classList.add('active');
            
            // Actualizar totales al cambiar de tab
            updateTotals();
        }
        
        function renderCategories() {
            var html = '';
            categories.forEach(function(cat) {
                var pct = cat.goal > 0 ? Math.round((cat.current/cat.goal)*100) : 0;
                html += '<div class="category-card"><strong>'+cat.name+'</strong> $'+cat.current+(cat.goal>0?' / $'+cat.goal:'')+'<br>';
                if(cat.goal>0) html += '<div style="height:6px;background:#e0e0e0;border-radius:3px;margin:8px 0;"><div style="height:100%;width:'+pct+'%;background:#667eea;border-radius:3px;"></div></div>';
                html += '<button class="btn" style="background:#f0f0f0;" onclick="openPaymentModal('+cat.id+')">Agregar Pago</button></div>';
            });
            document.getElementById('categoriesList').innerHTML = html;
            var totalGoal = categories.reduce(function(s,c){return s+(c.goal||0);},0);
            var totalCurrent = categories.reduce(function(s,c){return s+c.current;},0);
            var pct = totalGoal>0 ? Math.round((totalCurrent/totalGoal)*100) : 0;
            document.getElementById('totalPercent').textContent = pct+'%';
            document.getElementById('totalPaid').textContent = '$'+totalCurrent.toLocaleString();
            document.getElementById('totalGoal').textContent = '$'+totalGoal.toLocaleString();
        }
        
        function updateTotals() {
            var now = new Date();
            var today = new Date(now.getFullYear(), now.getMonth(), now.getDate());            
            // Gastos mensuales (para el tab Gastos)
            var monthlyExp = expenses.filter(function(e){
                var d=new Date(e.date);
                return d.getMonth()===now.getMonth()&&d.getFullYear()===now.getFullYear();
            });
            
            // Gastos de HOY (para el tab Diarios) - SE REINICIA AUTOM√ÅTICAMENTE
            var dailyExp = expenses.filter(function(e){
                var d=new Date(e.date);
                var expenseDate = new Date(d.getFullYear(), d.getMonth(), d.getDate());
                return expenseDate.getTime() === today.getTime();
            });
            
            // Ingresos mensuales
            var monthlyInc = incomes.filter(function(i){
                var d=new Date(i.date);
                return d.getMonth()===now.getMonth()&&d.getFullYear()===now.getFullYear();
            });
            
            // Calcular totales DIARIOS (solo de HOY)
            var gnc = dailyExp.filter(function(e){return e.type==='GNC';}).reduce(function(s,e){return s+e.amount;},0);
            var food = dailyExp.filter(function(e){return e.type==='Comida';}).reduce(function(s,e){return s+e.amount;},0);
            var varios = dailyExp.filter(function(e){return e.type==='Varios';}).reduce(function(s,e){return s+e.amount;},0);
            
            // Calcular totales MENSUALES (para balance)
            var didi = monthlyInc.filter(function(i){return i.type==='Didi';}).reduce(function(s,i){return s+i.amount;},0);
            var uber = monthlyInc.filter(function(i){return i.type==='Uber';}).reduce(function(s,i){return s+i.amount;},0);
            var balance = (didi+uber)-(gnc+food+varios);
            
            // Actualizar totales DIARIOS en la secci√≥n Diarios
            document.getElementById('totalGNC2').textContent = '$'+gnc.toLocaleString();
            document.getElementById('totalFood2').textContent = '$'+food.toLocaleString();
            document.getElementById('totalVarios2').textContent = '$'+varios.toLocaleString();
            
            // Actualizar totales MENSUALES en la secci√≥n Balance
            document.getElementById('totalDidi2').textContent = '$'+didi.toLocaleString();
            document.getElementById('totalUber2').textContent = '$'+uber.toLocaleString();
            document.getElementById('balanceAmount').textContent = (balance>=0?'+':'')+'$'+balance.toLocaleString();
            document.getElementById('balanceAmount').style.color = balance>=0?'white':'#ffcccc';
            if(balance<0) document.querySelector('.balance-box').style.background = 'linear-gradient(135deg, #e74c3c, #c0392b)';
        }
        
        function renderHistory() {
            var now = new Date();
            var all = [];
            
            // Todos los gastos del mes
            expenses.filter(function(e){
                var d=new Date(e.date);                return d.getMonth()===now.getMonth()&&d.getFullYear()===now.getFullYear();
            }).forEach(function(e){
                all.push({kind:'expense',category:e.type,amount:e.amount,date:e.date,id:e.id});
            });
            
            // Todos los ingresos del mes
            incomes.filter(function(i){
                var d=new Date(i.date);
                return d.getMonth()===now.getMonth()&&d.getFullYear()===now.getFullYear();
            }).forEach(function(i){
                all.push({kind:'income',category:i.type,amount:i.amount,date:i.date,id:i.id});
            });
            
            // Ordenar por fecha (m√°s reciente primero)
            all.sort(function(a,b){return new Date(b.date)-new Date(a.date);});
            
            var html = '';
            all.forEach(function(m){
                var icon = m.category==='GNC'?'‚õΩ':m.category==='Comida'?'üçî':m.category==='Varios'?'üì¶':m.category==='Didi'?'üü†':'‚ö´';
                var color = m.kind==='income'?'#27ae60':'#e74c3c';
                var dateObj = new Date(m.date);
                var dateStr = dateObj.toLocaleDateString('es-AR',{day:'2-digit',month:'2-digit',hour:'2-digit',minute:'2-digit'});
                html += '<div class="history-item"><div>'+icon+' '+m.category+'<br><small style="color:#7f8c8d;">'+dateStr+'</small></div><div style="color:'+color+';font-weight:bold;">'+(m.kind==='income'?'+':'-')+'$'+m.amount.toLocaleString()+' <button onclick="deleteItem(\''+m.kind+'\',\''+m.id+'\')" style="background:#e74c3c;color:white;border:none;padding:2px 6px;border-radius:4px;cursor:pointer;">X</button></div></div>';
            });
            document.getElementById('historyList').innerHTML = html || '<p style="text-align:center;color:#999;padding:20px;">Sin movimientos este mes</p>';
        }
        
        function openPaymentModal(id) { 
            currentType='payment'; 
            currentId=id; 
            document.getElementById('modalTitle').textContent='Agregar Pago'; 
            document.getElementById('modalAmount').value='';
            document.getElementById('modalName').style.display='none';
            document.getElementById('modalDate').style.display='none';
            document.getElementById('modal').classList.add('active'); 
        }
        function openCategoryModal() { 
            currentType='category'; 
            document.getElementById('modalTitle').textContent='Nueva Categoria'; 
            document.getElementById('modalName').value='';
            document.getElementById('modalAmount').value='';
            document.getElementById('modalName').style.display='block';
            document.getElementById('modalName').placeholder='Nombre de la categoria';
            document.getElementById('modalDate').style.display='none';
            document.getElementById('modal').classList.add('active'); 
        }
        function openIncomeModal(type) { 
            currentType='income'; 
            currentId=type; 
            document.getElementById('modalTitle').textContent='Ingreso '+type;             document.getElementById('modalAmount').value='';
            document.getElementById('modalName').style.display='none';
            document.getElementById('modalDate').style.display='block';
            document.getElementById('modal').classList.add('active'); 
        }
        function openDailyModal(type) { 
            currentType='expense'; 
            currentId=type; 
            document.getElementById('modalTitle').textContent='Gasto '+type; 
            document.getElementById('modalAmount').value='';
            document.getElementById('modalName').style.display='none';
            document.getElementById('modalDate').style.display='block';
            document.getElementById('modal').classList.add('active'); 
        }
        function closeModal() { 
            document.getElementById('modal').classList.remove('active'); 
        }
        
        function confirmAction() {
            var amount = parseFloat(document.getElementById('modalAmount').value);
            var date = document.getElementById('modalDate').value;
            var name = document.getElementById('modalName').value;
            
            if(currentType==='payment') {
                if(!amount||amount<=0){alert('Ingresa un monto v√°lido');return;}
                var cat = categories.find(function(c){return c.id===currentId;});
                if(cat) { cat.current+=amount; localStorage.setItem('categories',JSON.stringify(categories)); }
            } else if(currentType==='category') {
                if(!name||name.trim()===''){alert('Ingresa un nombre');return;}
                categories.push({id:Date.now(),name:name.trim(),goal:amount||0,current:0});
                localStorage.setItem('categories',JSON.stringify(categories));
            } else if(currentType==='income') {
                if(!amount||amount<=0){alert('Ingresa un monto v√°lido');return;}
                incomes.push({id:Date.now(),type:currentId,amount:amount,date:date});
                localStorage.setItem('incomes',JSON.stringify(incomes));
            } else if(currentType==='expense') {
                if(!amount||amount<=0){alert('Ingresa un monto v√°lido');return;}
                expenses.push({id:Date.now(),type:currentId,amount:amount,date:date});
                localStorage.setItem('expenses',JSON.stringify(expenses));
            }
            closeModal();
            init();
        }
        
        function deleteItem(kind,id) {
            if(!confirm('Eliminar?')) return;
            if(kind==='expense') { expenses=expenses.filter(function(e){return e.id!=id;}); localStorage.setItem('expenses',JSON.stringify(expenses)); }
            else { incomes=incomes.filter(function(i){return i.id!=id;}); localStorage.setItem('incomes',JSON.stringify(incomes)); }
            init();
        }        
        window.onclick = function(e) { if(e.target.classList.contains('modal')) closeModal(); };
        init();
    </script>
</body>
</html>
